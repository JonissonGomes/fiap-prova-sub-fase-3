# Guia de In√≠cio R√°pido - Keycloak

## üöÄ Configura√ß√£o R√°pida (5 minutos)

### 1. Iniciar Keycloak
```bash
# Iniciar o Keycloak
make keycloak

# Aguardar inicializa√ß√£o (pode levar 2-3 minutos)
# Acompanhar logs:
make keycloak-logs
```

### 2. Verificar se est√° funcionando
```bash
# Testar conectividade
curl http://localhost:8080/realms/master

# Deve retornar um JSON com informa√ß√µes do realm
```

### 3. Configurar automaticamente
```bash
# Executar configura√ß√£o autom√°tica
make keycloak-setup

# Aguardar mensagem de sucesso
```

### 4. Obter client secret
```bash
# Obter o client secret
make keycloak-secret

# Verificar se foi criado
cat /tmp/keycloak-credentials-development.env
```

### 5. Testar autentica√ß√£o
```bash
# Testar login
curl -X POST http://localhost:8002/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# Deve retornar access_token e refresh_token
```

## üîß Configura√ß√£o Manual (se autom√°tica falhar)

### 1. Acessar Console Admin
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### 2. Criar Realm
1. Clique em "Create Realm"
2. Nome: `vehicle-sales`
3. Clique em "Create"

### 3. Criar Client
1. V√° para "Clients" ‚Üí "Create client"
2. Client ID: `vehicle-sales-app`
3. Client type: `OpenID Connect`
4. Clique em "Next"
5. Client authentication: `ON`
6. Standard flow: `ON`
7. Direct access grants: `ON`
8. Clique em "Save"

### 4. Configurar Client
1. Na aba "Settings":
   - Valid redirect URIs: `http://localhost:3000/*`
   - Web origins: `http://localhost:3000`
2. Clique em "Save"

### 5. Obter Client Secret
1. V√° para aba "Credentials"
2. Copie o "Client secret"
3. Adicione ao arquivo `.env` do auth-service

### 6. Criar Roles
1. V√° para "Realm roles" ‚Üí "Create role"
2. Criar roles:
   - `ADMIN`
   - `SALES`
   - `CUSTOMER`

### 7. Criar Usu√°rio Admin
1. V√° para "Users" ‚Üí "Create user"
2. Username: `admin`
3. Email: `admin@example.com`
4. Clique em "Create"
5. Na aba "Credentials":
   - Password: `admin123`
   - Temporary: `OFF`
6. Na aba "Role mapping":
   - Assign role: `ADMIN`

## üö® Troubleshooting

### Keycloak n√£o inicia
```bash
# Verificar logs
make keycloak-logs

# Problemas comuns:
# 1. Porta 8080 j√° est√° em uso
sudo lsof -i :8080
# Parar processo que usa a porta ou mudar porta no docker-compose.yml

# 2. Falta de mem√≥ria
docker stats
# Aumentar mem√≥ria dispon√≠vel para Docker

# 3. Dados corrompidos
make keycloak-clean
make keycloak
```

### Client secret n√£o √© obtido
```bash
# Verificar se Keycloak est√° acess√≠vel
curl http://localhost:8080/realms/master

# Verificar se o realm existe
curl http://localhost:8080/realms/vehicle-sales

# Verificar se o client existe
# Acessar http://localhost:8080/admin e verificar manualmente

# Reconfigurar tudo
make keycloak-setup
make keycloak-secret
```

### Erro de autentica√ß√£o
```bash
# Verificar se o client secret est√° correto
cat /tmp/keycloak-credentials-development.env

# Verificar se o auth service est√° usando o secret correto
make auth-logs

# Verificar se o usu√°rio admin existe
# Acessar http://localhost:8080/admin ‚Üí Users
```

### Erro 401 Unauthorized
```bash
# Verificar se o token est√° sendo enviado corretamente
curl -X GET http://localhost:8002/auth/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"

# Verificar se o token n√£o expirou
# Tokens duram 5 minutos por padr√£o
```

## üìù Comandos √öteis

### Keycloak
```bash
make keycloak              # Iniciar Keycloak
make keycloak-logs         # Ver logs
make keycloak-setup        # Configura√ß√£o autom√°tica
make keycloak-secret       # Obter client secret
make keycloak-console      # Mostrar info do console
make keycloak-clean        # Limpar dados
make keycloak-restart      # Reiniciar
```

### Verifica√ß√£o
```bash
# Status dos servi√ßos
make status

# Logs do auth service
make auth-logs

# Testar health check
curl http://localhost:8002/health
```

## üîê Credenciais Padr√£o

### Console Admin Keycloak
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### Usu√°rio da Aplica√ß√£o
- Username: `admin`
- Password: `admin123`
- Role: `ADMIN`

## üåê URLs Importantes

- **Keycloak Admin**: http://localhost:8080/admin
- **Realm vehicle-sales**: http://localhost:8080/realms/vehicle-sales
- **Auth Service**: http://localhost:8002
- **Auth Service Docs**: http://localhost:8002/docs
- **Frontend**: http://localhost:3000

## üìä Valida√ß√£o da Configura√ß√£o

### Checklist
- [ ] Keycloak est√° rodando na porta 8080
- [ ] Realm `vehicle-sales` existe
- [ ] Client `vehicle-sales-app` existe
- [ ] Client secret foi obtido
- [ ] Usu√°rio admin existe com role ADMIN
- [ ] Auth service consegue se comunicar com Keycloak
- [ ] Frontend consegue fazer login

### Script de Valida√ß√£o
```bash
#!/bin/bash
echo "üîç Validando configura√ß√£o do Keycloak..."

# 1. Verificar se Keycloak est√° rodando
if curl -s http://localhost:8080/realms/master > /dev/null; then
    echo "‚úÖ Keycloak est√° rodando"
else
    echo "‚ùå Keycloak n√£o est√° acess√≠vel"
    exit 1
fi

# 2. Verificar se realm existe
if curl -s http://localhost:8080/realms/vehicle-sales > /dev/null; then
    echo "‚úÖ Realm vehicle-sales existe"
else
    echo "‚ùå Realm vehicle-sales n√£o existe"
    exit 1
fi

# 3. Verificar se client secret existe
if [ -f "/tmp/keycloak-credentials-development.env" ]; then
    echo "‚úÖ Client secret foi obtido"
else
    echo "‚ùå Client secret n√£o foi obtido"
    exit 1
fi

# 4. Testar autentica√ß√£o
if curl -s -X POST http://localhost:8002/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "admin", "password": "admin123"}' | grep -q "access_token"; then
    echo "‚úÖ Autentica√ß√£o funcionando"
else
    echo "‚ùå Erro na autentica√ß√£o"
    exit 1
fi

echo "üéâ Configura√ß√£o do Keycloak est√° correta!"
```

## üîÑ Pr√≥ximos Passos

Ap√≥s configurar o Keycloak:

1. **Iniciar todos os servi√ßos**:
   ```bash
   make up
   ```

2. **Acessar o frontend**:
   ```bash
   # Abrir http://localhost:3000
   # Fazer login com admin/admin123
   ```

3. **Testar funcionalidades**:
   - Criar ve√≠culos
   - Gerenciar clientes
   - Processar vendas

4. **Configurar para produ√ß√£o**:
   - Seguir [Guia de Produ√ß√£o](KEYCLOAK_PRODUCTION_GUIDE.md)
   - Configurar HTTPS
   - Usar senhas seguras 

## üöÄ Configura√ß√£o R√°pida (5 minutos)

### 1. Iniciar Keycloak
```bash
# Iniciar o Keycloak
make keycloak

# Aguardar inicializa√ß√£o (pode levar 2-3 minutos)
# Acompanhar logs:
make keycloak-logs
```

### 2. Verificar se est√° funcionando
```bash
# Testar conectividade
curl http://localhost:8080/realms/master

# Deve retornar um JSON com informa√ß√µes do realm
```

### 3. Configurar automaticamente
```bash
# Executar configura√ß√£o autom√°tica
make keycloak-setup

# Aguardar mensagem de sucesso
```

### 4. Obter client secret
```bash
# Obter o client secret
make keycloak-secret

# Verificar se foi criado
cat /tmp/keycloak-credentials-development.env
```

### 5. Testar autentica√ß√£o
```bash
# Testar login
curl -X POST http://localhost:8002/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# Deve retornar access_token e refresh_token
```

## üîß Configura√ß√£o Manual (se autom√°tica falhar)

### 1. Acessar Console Admin
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### 2. Criar Realm
1. Clique em "Create Realm"
2. Nome: `vehicle-sales`
3. Clique em "Create"

### 3. Criar Client
1. V√° para "Clients" ‚Üí "Create client"
2. Client ID: `vehicle-sales-app`
3. Client type: `OpenID Connect`
4. Clique em "Next"
5. Client authentication: `ON`
6. Standard flow: `ON`
7. Direct access grants: `ON`
8. Clique em "Save"

### 4. Configurar Client
1. Na aba "Settings":
   - Valid redirect URIs: `http://localhost:3000/*`
   - Web origins: `http://localhost:3000`
2. Clique em "Save"

### 5. Obter Client Secret
1. V√° para aba "Credentials"
2. Copie o "Client secret"
3. Adicione ao arquivo `.env` do auth-service

### 6. Criar Roles
1. V√° para "Realm roles" ‚Üí "Create role"
2. Criar roles:
   - `ADMIN`
   - `SALES`
   - `CUSTOMER`

### 7. Criar Usu√°rio Admin
1. V√° para "Users" ‚Üí "Create user"
2. Username: `admin`
3. Email: `admin@example.com`
4. Clique em "Create"
5. Na aba "Credentials":
   - Password: `admin123`
   - Temporary: `OFF`
6. Na aba "Role mapping":
   - Assign role: `ADMIN`

## üö® Troubleshooting

### Keycloak n√£o inicia
```bash
# Verificar logs
make keycloak-logs

# Problemas comuns:
# 1. Porta 8080 j√° est√° em uso
sudo lsof -i :8080
# Parar processo que usa a porta ou mudar porta no docker-compose.yml

# 2. Falta de mem√≥ria
docker stats
# Aumentar mem√≥ria dispon√≠vel para Docker

# 3. Dados corrompidos
make keycloak-clean
make keycloak
```

### Client secret n√£o √© obtido
```bash
# Verificar se Keycloak est√° acess√≠vel
curl http://localhost:8080/realms/master

# Verificar se o realm existe
curl http://localhost:8080/realms/vehicle-sales

# Verificar se o client existe
# Acessar http://localhost:8080/admin e verificar manualmente

# Reconfigurar tudo
make keycloak-setup
make keycloak-secret
```

### Erro de autentica√ß√£o
```bash
# Verificar se o client secret est√° correto
cat /tmp/keycloak-credentials-development.env

# Verificar se o auth service est√° usando o secret correto
make auth-logs

# Verificar se o usu√°rio admin existe
# Acessar http://localhost:8080/admin ‚Üí Users
```

### Erro 401 Unauthorized
```bash
# Verificar se o token est√° sendo enviado corretamente
curl -X GET http://localhost:8002/auth/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"

# Verificar se o token n√£o expirou
# Tokens duram 5 minutos por padr√£o
```

## üìù Comandos √öteis

### Keycloak
```bash
make keycloak              # Iniciar Keycloak
make keycloak-logs         # Ver logs
make keycloak-setup        # Configura√ß√£o autom√°tica
make keycloak-secret       # Obter client secret
make keycloak-console      # Mostrar info do console
make keycloak-clean        # Limpar dados
make keycloak-restart      # Reiniciar
```

### Verifica√ß√£o
```bash
# Status dos servi√ßos
make status

# Logs do auth service
make auth-logs

# Testar health check
curl http://localhost:8002/health
```

## üîê Credenciais Padr√£o

### Console Admin Keycloak
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### Usu√°rio da Aplica√ß√£o
- Username: `admin`
- Password: `admin123`
- Role: `ADMIN`

## üåê URLs Importantes

- **Keycloak Admin**: http://localhost:8080/admin
- **Realm vehicle-sales**: http://localhost:8080/realms/vehicle-sales
- **Auth Service**: http://localhost:8002
- **Auth Service Docs**: http://localhost:8002/docs
- **Frontend**: http://localhost:3000

## üìä Valida√ß√£o da Configura√ß√£o

### Checklist
- [ ] Keycloak est√° rodando na porta 8080
- [ ] Realm `vehicle-sales` existe
- [ ] Client `vehicle-sales-app` existe
- [ ] Client secret foi obtido
- [ ] Usu√°rio admin existe com role ADMIN
- [ ] Auth service consegue se comunicar com Keycloak
- [ ] Frontend consegue fazer login

### Script de Valida√ß√£o
```bash
#!/bin/bash
echo "üîç Validando configura√ß√£o do Keycloak..."

# 1. Verificar se Keycloak est√° rodando
if curl -s http://localhost:8080/realms/master > /dev/null; then
    echo "‚úÖ Keycloak est√° rodando"
else
    echo "‚ùå Keycloak n√£o est√° acess√≠vel"
    exit 1
fi

# 2. Verificar se realm existe
if curl -s http://localhost:8080/realms/vehicle-sales > /dev/null; then
    echo "‚úÖ Realm vehicle-sales existe"
else
    echo "‚ùå Realm vehicle-sales n√£o existe"
    exit 1
fi

# 3. Verificar se client secret existe
if [ -f "/tmp/keycloak-credentials-development.env" ]; then
    echo "‚úÖ Client secret foi obtido"
else
    echo "‚ùå Client secret n√£o foi obtido"
    exit 1
fi

# 4. Testar autentica√ß√£o
if curl -s -X POST http://localhost:8002/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "admin", "password": "admin123"}' | grep -q "access_token"; then
    echo "‚úÖ Autentica√ß√£o funcionando"
else
    echo "‚ùå Erro na autentica√ß√£o"
    exit 1
fi

echo "üéâ Configura√ß√£o do Keycloak est√° correta!"
```

## üîÑ Pr√≥ximos Passos

Ap√≥s configurar o Keycloak:

1. **Iniciar todos os servi√ßos**:
   ```bash
   make up
   ```

2. **Acessar o frontend**:
   ```bash
   # Abrir http://localhost:3000
   # Fazer login com admin/admin123
   ```

3. **Testar funcionalidades**:
   - Criar ve√≠culos
   - Gerenciar clientes
   - Processar vendas

4. **Configurar para produ√ß√£o**:
   - Seguir [Guia de Produ√ß√£o](KEYCLOAK_PRODUCTION_GUIDE.md)
   - Configurar HTTPS
   - Usar senhas seguras 

## üöÄ Configura√ß√£o R√°pida (5 minutos)

### 1. Iniciar Keycloak
```bash
# Iniciar o Keycloak
make keycloak

# Aguardar inicializa√ß√£o (pode levar 2-3 minutos)
# Acompanhar logs:
make keycloak-logs
```

### 2. Verificar se est√° funcionando
```bash
# Testar conectividade
curl http://localhost:8080/realms/master

# Deve retornar um JSON com informa√ß√µes do realm
```

### 3. Configurar automaticamente
```bash
# Executar configura√ß√£o autom√°tica
make keycloak-setup

# Aguardar mensagem de sucesso
```

### 4. Obter client secret
```bash
# Obter o client secret
make keycloak-secret

# Verificar se foi criado
cat /tmp/keycloak-credentials-development.env
```

### 5. Testar autentica√ß√£o
```bash
# Testar login
curl -X POST http://localhost:8002/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# Deve retornar access_token e refresh_token
```

## üîß Configura√ß√£o Manual (se autom√°tica falhar)

### 1. Acessar Console Admin
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### 2. Criar Realm
1. Clique em "Create Realm"
2. Nome: `vehicle-sales`
3. Clique em "Create"

### 3. Criar Client
1. V√° para "Clients" ‚Üí "Create client"
2. Client ID: `vehicle-sales-app`
3. Client type: `OpenID Connect`
4. Clique em "Next"
5. Client authentication: `ON`
6. Standard flow: `ON`
7. Direct access grants: `ON`
8. Clique em "Save"

### 4. Configurar Client
1. Na aba "Settings":
   - Valid redirect URIs: `http://localhost:3000/*`
   - Web origins: `http://localhost:3000`
2. Clique em "Save"

### 5. Obter Client Secret
1. V√° para aba "Credentials"
2. Copie o "Client secret"
3. Adicione ao arquivo `.env` do auth-service

### 6. Criar Roles
1. V√° para "Realm roles" ‚Üí "Create role"
2. Criar roles:
   - `ADMIN`
   - `SALES`
   - `CUSTOMER`

### 7. Criar Usu√°rio Admin
1. V√° para "Users" ‚Üí "Create user"
2. Username: `admin`
3. Email: `admin@example.com`
4. Clique em "Create"
5. Na aba "Credentials":
   - Password: `admin123`
   - Temporary: `OFF`
6. Na aba "Role mapping":
   - Assign role: `ADMIN`

## üö® Troubleshooting

### Keycloak n√£o inicia
```bash
# Verificar logs
make keycloak-logs

# Problemas comuns:
# 1. Porta 8080 j√° est√° em uso
sudo lsof -i :8080
# Parar processo que usa a porta ou mudar porta no docker-compose.yml

# 2. Falta de mem√≥ria
docker stats
# Aumentar mem√≥ria dispon√≠vel para Docker

# 3. Dados corrompidos
make keycloak-clean
make keycloak
```

### Client secret n√£o √© obtido
```bash
# Verificar se Keycloak est√° acess√≠vel
curl http://localhost:8080/realms/master

# Verificar se o realm existe
curl http://localhost:8080/realms/vehicle-sales

# Verificar se o client existe
# Acessar http://localhost:8080/admin e verificar manualmente

# Reconfigurar tudo
make keycloak-setup
make keycloak-secret
```

### Erro de autentica√ß√£o
```bash
# Verificar se o client secret est√° correto
cat /tmp/keycloak-credentials-development.env

# Verificar se o auth service est√° usando o secret correto
make auth-logs

# Verificar se o usu√°rio admin existe
# Acessar http://localhost:8080/admin ‚Üí Users
```

### Erro 401 Unauthorized
```bash
# Verificar se o token est√° sendo enviado corretamente
curl -X GET http://localhost:8002/auth/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"

# Verificar se o token n√£o expirou
# Tokens duram 5 minutos por padr√£o
```

## üìù Comandos √öteis

### Keycloak
```bash
make keycloak              # Iniciar Keycloak
make keycloak-logs         # Ver logs
make keycloak-setup        # Configura√ß√£o autom√°tica
make keycloak-secret       # Obter client secret
make keycloak-console      # Mostrar info do console
make keycloak-clean        # Limpar dados
make keycloak-restart      # Reiniciar
```

### Verifica√ß√£o
```bash
# Status dos servi√ßos
make status

# Logs do auth service
make auth-logs

# Testar health check
curl http://localhost:8002/health
```

## üîê Credenciais Padr√£o

### Console Admin Keycloak
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### Usu√°rio da Aplica√ß√£o
- Username: `admin`
- Password: `admin123`
- Role: `ADMIN`

## üåê URLs Importantes

- **Keycloak Admin**: http://localhost:8080/admin
- **Realm vehicle-sales**: http://localhost:8080/realms/vehicle-sales
- **Auth Service**: http://localhost:8002
- **Auth Service Docs**: http://localhost:8002/docs
- **Frontend**: http://localhost:3000

## üìä Valida√ß√£o da Configura√ß√£o

### Checklist
- [ ] Keycloak est√° rodando na porta 8080
- [ ] Realm `vehicle-sales` existe
- [ ] Client `vehicle-sales-app` existe
- [ ] Client secret foi obtido
- [ ] Usu√°rio admin existe com role ADMIN
- [ ] Auth service consegue se comunicar com Keycloak
- [ ] Frontend consegue fazer login

### Script de Valida√ß√£o
```bash
#!/bin/bash
echo "üîç Validando configura√ß√£o do Keycloak..."

# 1. Verificar se Keycloak est√° rodando
if curl -s http://localhost:8080/realms/master > /dev/null; then
    echo "‚úÖ Keycloak est√° rodando"
else
    echo "‚ùå Keycloak n√£o est√° acess√≠vel"
    exit 1
fi

# 2. Verificar se realm existe
if curl -s http://localhost:8080/realms/vehicle-sales > /dev/null; then
    echo "‚úÖ Realm vehicle-sales existe"
else
    echo "‚ùå Realm vehicle-sales n√£o existe"
    exit 1
fi

# 3. Verificar se client secret existe
if [ -f "/tmp/keycloak-credentials-development.env" ]; then
    echo "‚úÖ Client secret foi obtido"
else
    echo "‚ùå Client secret n√£o foi obtido"
    exit 1
fi

# 4. Testar autentica√ß√£o
if curl -s -X POST http://localhost:8002/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "admin", "password": "admin123"}' | grep -q "access_token"; then
    echo "‚úÖ Autentica√ß√£o funcionando"
else
    echo "‚ùå Erro na autentica√ß√£o"
    exit 1
fi

echo "üéâ Configura√ß√£o do Keycloak est√° correta!"
```

## üîÑ Pr√≥ximos Passos

Ap√≥s configurar o Keycloak:

1. **Iniciar todos os servi√ßos**:
   ```bash
   make up
   ```

2. **Acessar o frontend**:
   ```bash
   # Abrir http://localhost:3000
   # Fazer login com admin/admin123
   ```

3. **Testar funcionalidades**:
   - Criar ve√≠culos
   - Gerenciar clientes
   - Processar vendas

4. **Configurar para produ√ß√£o**:
   - Seguir [Guia de Produ√ß√£o](KEYCLOAK_PRODUCTION_GUIDE.md)
   - Configurar HTTPS
   - Usar senhas seguras 

## üöÄ Configura√ß√£o R√°pida (5 minutos)

### 1. Iniciar Keycloak
```bash
# Iniciar o Keycloak
make keycloak

# Aguardar inicializa√ß√£o (pode levar 2-3 minutos)
# Acompanhar logs:
make keycloak-logs
```

### 2. Verificar se est√° funcionando
```bash
# Testar conectividade
curl http://localhost:8080/realms/master

# Deve retornar um JSON com informa√ß√µes do realm
```

### 3. Configurar automaticamente
```bash
# Executar configura√ß√£o autom√°tica
make keycloak-setup

# Aguardar mensagem de sucesso
```

### 4. Obter client secret
```bash
# Obter o client secret
make keycloak-secret

# Verificar se foi criado
cat /tmp/keycloak-credentials-development.env
```

### 5. Testar autentica√ß√£o
```bash
# Testar login
curl -X POST http://localhost:8002/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# Deve retornar access_token e refresh_token
```

## üîß Configura√ß√£o Manual (se autom√°tica falhar)

### 1. Acessar Console Admin
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### 2. Criar Realm
1. Clique em "Create Realm"
2. Nome: `vehicle-sales`
3. Clique em "Create"

### 3. Criar Client
1. V√° para "Clients" ‚Üí "Create client"
2. Client ID: `vehicle-sales-app`
3. Client type: `OpenID Connect`
4. Clique em "Next"
5. Client authentication: `ON`
6. Standard flow: `ON`
7. Direct access grants: `ON`
8. Clique em "Save"

### 4. Configurar Client
1. Na aba "Settings":
   - Valid redirect URIs: `http://localhost:3000/*`
   - Web origins: `http://localhost:3000`
2. Clique em "Save"

### 5. Obter Client Secret
1. V√° para aba "Credentials"
2. Copie o "Client secret"
3. Adicione ao arquivo `.env` do auth-service

### 6. Criar Roles
1. V√° para "Realm roles" ‚Üí "Create role"
2. Criar roles:
   - `ADMIN`
   - `SALES`
   - `CUSTOMER`

### 7. Criar Usu√°rio Admin
1. V√° para "Users" ‚Üí "Create user"
2. Username: `admin`
3. Email: `admin@example.com`
4. Clique em "Create"
5. Na aba "Credentials":
   - Password: `admin123`
   - Temporary: `OFF`
6. Na aba "Role mapping":
   - Assign role: `ADMIN`

## üö® Troubleshooting

### Keycloak n√£o inicia
```bash
# Verificar logs
make keycloak-logs

# Problemas comuns:
# 1. Porta 8080 j√° est√° em uso
sudo lsof -i :8080
# Parar processo que usa a porta ou mudar porta no docker-compose.yml

# 2. Falta de mem√≥ria
docker stats
# Aumentar mem√≥ria dispon√≠vel para Docker

# 3. Dados corrompidos
make keycloak-clean
make keycloak
```

### Client secret n√£o √© obtido
```bash
# Verificar se Keycloak est√° acess√≠vel
curl http://localhost:8080/realms/master

# Verificar se o realm existe
curl http://localhost:8080/realms/vehicle-sales

# Verificar se o client existe
# Acessar http://localhost:8080/admin e verificar manualmente

# Reconfigurar tudo
make keycloak-setup
make keycloak-secret
```

### Erro de autentica√ß√£o
```bash
# Verificar se o client secret est√° correto
cat /tmp/keycloak-credentials-development.env

# Verificar se o auth service est√° usando o secret correto
make auth-logs

# Verificar se o usu√°rio admin existe
# Acessar http://localhost:8080/admin ‚Üí Users
```

### Erro 401 Unauthorized
```bash
# Verificar se o token est√° sendo enviado corretamente
curl -X GET http://localhost:8002/auth/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"

# Verificar se o token n√£o expirou
# Tokens duram 5 minutos por padr√£o
```

## üìù Comandos √öteis

### Keycloak
```bash
make keycloak              # Iniciar Keycloak
make keycloak-logs         # Ver logs
make keycloak-setup        # Configura√ß√£o autom√°tica
make keycloak-secret       # Obter client secret
make keycloak-console      # Mostrar info do console
make keycloak-clean        # Limpar dados
make keycloak-restart      # Reiniciar
```

### Verifica√ß√£o
```bash
# Status dos servi√ßos
make status

# Logs do auth service
make auth-logs

# Testar health check
curl http://localhost:8002/health
```

## üîê Credenciais Padr√£o

### Console Admin Keycloak
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### Usu√°rio da Aplica√ß√£o
- Username: `admin`
- Password: `admin123`
- Role: `ADMIN`

## üåê URLs Importantes

- **Keycloak Admin**: http://localhost:8080/admin
- **Realm vehicle-sales**: http://localhost:8080/realms/vehicle-sales
- **Auth Service**: http://localhost:8002
- **Auth Service Docs**: http://localhost:8002/docs
- **Frontend**: http://localhost:3000

## üìä Valida√ß√£o da Configura√ß√£o

### Checklist
- [ ] Keycloak est√° rodando na porta 8080
- [ ] Realm `vehicle-sales` existe
- [ ] Client `vehicle-sales-app` existe
- [ ] Client secret foi obtido
- [ ] Usu√°rio admin existe com role ADMIN
- [ ] Auth service consegue se comunicar com Keycloak
- [ ] Frontend consegue fazer login

### Script de Valida√ß√£o
```bash
#!/bin/bash
echo "üîç Validando configura√ß√£o do Keycloak..."

# 1. Verificar se Keycloak est√° rodando
if curl -s http://localhost:8080/realms/master > /dev/null; then
    echo "‚úÖ Keycloak est√° rodando"
else
    echo "‚ùå Keycloak n√£o est√° acess√≠vel"
    exit 1
fi

# 2. Verificar se realm existe
if curl -s http://localhost:8080/realms/vehicle-sales > /dev/null; then
    echo "‚úÖ Realm vehicle-sales existe"
else
    echo "‚ùå Realm vehicle-sales n√£o existe"
    exit 1
fi

# 3. Verificar se client secret existe
if [ -f "/tmp/keycloak-credentials-development.env" ]; then
    echo "‚úÖ Client secret foi obtido"
else
    echo "‚ùå Client secret n√£o foi obtido"
    exit 1
fi

# 4. Testar autentica√ß√£o
if curl -s -X POST http://localhost:8002/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "admin", "password": "admin123"}' | grep -q "access_token"; then
    echo "‚úÖ Autentica√ß√£o funcionando"
else
    echo "‚ùå Erro na autentica√ß√£o"
    exit 1
fi

echo "üéâ Configura√ß√£o do Keycloak est√° correta!"
```

## üîÑ Pr√≥ximos Passos

Ap√≥s configurar o Keycloak:

1. **Iniciar todos os servi√ßos**:
   ```bash
   make up
   ```

2. **Acessar o frontend**:
   ```bash
   # Abrir http://localhost:3000
   # Fazer login com admin/admin123
   ```

3. **Testar funcionalidades**:
   - Criar ve√≠culos
   - Gerenciar clientes
   - Processar vendas

4. **Configurar para produ√ß√£o**:
   - Seguir [Guia de Produ√ß√£o](KEYCLOAK_PRODUCTION_GUIDE.md)
   - Configurar HTTPS
   - Usar senhas seguras 

## üöÄ Configura√ß√£o R√°pida (5 minutos)

### 1. Iniciar Keycloak
```bash
# Iniciar o Keycloak
make keycloak

# Aguardar inicializa√ß√£o (pode levar 2-3 minutos)
# Acompanhar logs:
make keycloak-logs
```

### 2. Verificar se est√° funcionando
```bash
# Testar conectividade
curl http://localhost:8080/realms/master

# Deve retornar um JSON com informa√ß√µes do realm
```

### 3. Configurar automaticamente
```bash
# Executar configura√ß√£o autom√°tica
make keycloak-setup

# Aguardar mensagem de sucesso
```

### 4. Obter client secret
```bash
# Obter o client secret
make keycloak-secret

# Verificar se foi criado
cat /tmp/keycloak-credentials-development.env
```

### 5. Testar autentica√ß√£o
```bash
# Testar login
curl -X POST http://localhost:8002/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# Deve retornar access_token e refresh_token
```

## üîß Configura√ß√£o Manual (se autom√°tica falhar)

### 1. Acessar Console Admin
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### 2. Criar Realm
1. Clique em "Create Realm"
2. Nome: `vehicle-sales`
3. Clique em "Create"

### 3. Criar Client
1. V√° para "Clients" ‚Üí "Create client"
2. Client ID: `vehicle-sales-app`
3. Client type: `OpenID Connect`
4. Clique em "Next"
5. Client authentication: `ON`
6. Standard flow: `ON`
7. Direct access grants: `ON`
8. Clique em "Save"

### 4. Configurar Client
1. Na aba "Settings":
   - Valid redirect URIs: `http://localhost:3000/*`
   - Web origins: `http://localhost:3000`
2. Clique em "Save"

### 5. Obter Client Secret
1. V√° para aba "Credentials"
2. Copie o "Client secret"
3. Adicione ao arquivo `.env` do auth-service

### 6. Criar Roles
1. V√° para "Realm roles" ‚Üí "Create role"
2. Criar roles:
   - `ADMIN`
   - `SALES`
   - `CUSTOMER`

### 7. Criar Usu√°rio Admin
1. V√° para "Users" ‚Üí "Create user"
2. Username: `admin`
3. Email: `admin@example.com`
4. Clique em "Create"
5. Na aba "Credentials":
   - Password: `admin123`
   - Temporary: `OFF`
6. Na aba "Role mapping":
   - Assign role: `ADMIN`

## üö® Troubleshooting

### Keycloak n√£o inicia
```bash
# Verificar logs
make keycloak-logs

# Problemas comuns:
# 1. Porta 8080 j√° est√° em uso
sudo lsof -i :8080
# Parar processo que usa a porta ou mudar porta no docker-compose.yml

# 2. Falta de mem√≥ria
docker stats
# Aumentar mem√≥ria dispon√≠vel para Docker

# 3. Dados corrompidos
make keycloak-clean
make keycloak
```

### Client secret n√£o √© obtido
```bash
# Verificar se Keycloak est√° acess√≠vel
curl http://localhost:8080/realms/master

# Verificar se o realm existe
curl http://localhost:8080/realms/vehicle-sales

# Verificar se o client existe
# Acessar http://localhost:8080/admin e verificar manualmente

# Reconfigurar tudo
make keycloak-setup
make keycloak-secret
```

### Erro de autentica√ß√£o
```bash
# Verificar se o client secret est√° correto
cat /tmp/keycloak-credentials-development.env

# Verificar se o auth service est√° usando o secret correto
make auth-logs

# Verificar se o usu√°rio admin existe
# Acessar http://localhost:8080/admin ‚Üí Users
```

### Erro 401 Unauthorized
```bash
# Verificar se o token est√° sendo enviado corretamente
curl -X GET http://localhost:8002/auth/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"

# Verificar se o token n√£o expirou
# Tokens duram 5 minutos por padr√£o
```

## üìù Comandos √öteis

### Keycloak
```bash
make keycloak              # Iniciar Keycloak
make keycloak-logs         # Ver logs
make keycloak-setup        # Configura√ß√£o autom√°tica
make keycloak-secret       # Obter client secret
make keycloak-console      # Mostrar info do console
make keycloak-clean        # Limpar dados
make keycloak-restart      # Reiniciar
```

### Verifica√ß√£o
```bash
# Status dos servi√ßos
make status

# Logs do auth service
make auth-logs

# Testar health check
curl http://localhost:8002/health
```

## üîê Credenciais Padr√£o

### Console Admin Keycloak
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### Usu√°rio da Aplica√ß√£o
- Username: `admin`
- Password: `admin123`
- Role: `ADMIN`

## üåê URLs Importantes

- **Keycloak Admin**: http://localhost:8080/admin
- **Realm vehicle-sales**: http://localhost:8080/realms/vehicle-sales
- **Auth Service**: http://localhost:8002
- **Auth Service Docs**: http://localhost:8002/docs
- **Frontend**: http://localhost:3000

## üìä Valida√ß√£o da Configura√ß√£o

### Checklist
- [ ] Keycloak est√° rodando na porta 8080
- [ ] Realm `vehicle-sales` existe
- [ ] Client `vehicle-sales-app` existe
- [ ] Client secret foi obtido
- [ ] Usu√°rio admin existe com role ADMIN
- [ ] Auth service consegue se comunicar com Keycloak
- [ ] Frontend consegue fazer login

### Script de Valida√ß√£o
```bash
#!/bin/bash
echo "üîç Validando configura√ß√£o do Keycloak..."

# 1. Verificar se Keycloak est√° rodando
if curl -s http://localhost:8080/realms/master > /dev/null; then
    echo "‚úÖ Keycloak est√° rodando"
else
    echo "‚ùå Keycloak n√£o est√° acess√≠vel"
    exit 1
fi

# 2. Verificar se realm existe
if curl -s http://localhost:8080/realms/vehicle-sales > /dev/null; then
    echo "‚úÖ Realm vehicle-sales existe"
else
    echo "‚ùå Realm vehicle-sales n√£o existe"
    exit 1
fi

# 3. Verificar se client secret existe
if [ -f "/tmp/keycloak-credentials-development.env" ]; then
    echo "‚úÖ Client secret foi obtido"
else
    echo "‚ùå Client secret n√£o foi obtido"
    exit 1
fi

# 4. Testar autentica√ß√£o
if curl -s -X POST http://localhost:8002/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "admin", "password": "admin123"}' | grep -q "access_token"; then
    echo "‚úÖ Autentica√ß√£o funcionando"
else
    echo "‚ùå Erro na autentica√ß√£o"
    exit 1
fi

echo "üéâ Configura√ß√£o do Keycloak est√° correta!"
```

## üîÑ Pr√≥ximos Passos

Ap√≥s configurar o Keycloak:

1. **Iniciar todos os servi√ßos**:
   ```bash
   make up
   ```

2. **Acessar o frontend**:
   ```bash
   # Abrir http://localhost:3000
   # Fazer login com admin/admin123
   ```

3. **Testar funcionalidades**:
   - Criar ve√≠culos
   - Gerenciar clientes
   - Processar vendas

4. **Configurar para produ√ß√£o**:
   - Seguir [Guia de Produ√ß√£o](KEYCLOAK_PRODUCTION_GUIDE.md)
   - Configurar HTTPS
   - Usar senhas seguras 

## üöÄ Configura√ß√£o R√°pida (5 minutos)

### 1. Iniciar Keycloak
```bash
# Iniciar o Keycloak
make keycloak

# Aguardar inicializa√ß√£o (pode levar 2-3 minutos)
# Acompanhar logs:
make keycloak-logs
```

### 2. Verificar se est√° funcionando
```bash
# Testar conectividade
curl http://localhost:8080/realms/master

# Deve retornar um JSON com informa√ß√µes do realm
```

### 3. Configurar automaticamente
```bash
# Executar configura√ß√£o autom√°tica
make keycloak-setup

# Aguardar mensagem de sucesso
```

### 4. Obter client secret
```bash
# Obter o client secret
make keycloak-secret

# Verificar se foi criado
cat /tmp/keycloak-credentials-development.env
```

### 5. Testar autentica√ß√£o
```bash
# Testar login
curl -X POST http://localhost:8002/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# Deve retornar access_token e refresh_token
```

## üîß Configura√ß√£o Manual (se autom√°tica falhar)

### 1. Acessar Console Admin
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### 2. Criar Realm
1. Clique em "Create Realm"
2. Nome: `vehicle-sales`
3. Clique em "Create"

### 3. Criar Client
1. V√° para "Clients" ‚Üí "Create client"
2. Client ID: `vehicle-sales-app`
3. Client type: `OpenID Connect`
4. Clique em "Next"
5. Client authentication: `ON`
6. Standard flow: `ON`
7. Direct access grants: `ON`
8. Clique em "Save"

### 4. Configurar Client
1. Na aba "Settings":
   - Valid redirect URIs: `http://localhost:3000/*`
   - Web origins: `http://localhost:3000`
2. Clique em "Save"

### 5. Obter Client Secret
1. V√° para aba "Credentials"
2. Copie o "Client secret"
3. Adicione ao arquivo `.env` do auth-service

### 6. Criar Roles
1. V√° para "Realm roles" ‚Üí "Create role"
2. Criar roles:
   - `ADMIN`
   - `SALES`
   - `CUSTOMER`

### 7. Criar Usu√°rio Admin
1. V√° para "Users" ‚Üí "Create user"
2. Username: `admin`
3. Email: `admin@example.com`
4. Clique em "Create"
5. Na aba "Credentials":
   - Password: `admin123`
   - Temporary: `OFF`
6. Na aba "Role mapping":
   - Assign role: `ADMIN`

## üö® Troubleshooting

### Keycloak n√£o inicia
```bash
# Verificar logs
make keycloak-logs

# Problemas comuns:
# 1. Porta 8080 j√° est√° em uso
sudo lsof -i :8080
# Parar processo que usa a porta ou mudar porta no docker-compose.yml

# 2. Falta de mem√≥ria
docker stats
# Aumentar mem√≥ria dispon√≠vel para Docker

# 3. Dados corrompidos
make keycloak-clean
make keycloak
```

### Client secret n√£o √© obtido
```bash
# Verificar se Keycloak est√° acess√≠vel
curl http://localhost:8080/realms/master

# Verificar se o realm existe
curl http://localhost:8080/realms/vehicle-sales

# Verificar se o client existe
# Acessar http://localhost:8080/admin e verificar manualmente

# Reconfigurar tudo
make keycloak-setup
make keycloak-secret
```

### Erro de autentica√ß√£o
```bash
# Verificar se o client secret est√° correto
cat /tmp/keycloak-credentials-development.env

# Verificar se o auth service est√° usando o secret correto
make auth-logs

# Verificar se o usu√°rio admin existe
# Acessar http://localhost:8080/admin ‚Üí Users
```

### Erro 401 Unauthorized
```bash
# Verificar se o token est√° sendo enviado corretamente
curl -X GET http://localhost:8002/auth/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"

# Verificar se o token n√£o expirou
# Tokens duram 5 minutos por padr√£o
```

## üìù Comandos √öteis

### Keycloak
```bash
make keycloak              # Iniciar Keycloak
make keycloak-logs         # Ver logs
make keycloak-setup        # Configura√ß√£o autom√°tica
make keycloak-secret       # Obter client secret
make keycloak-console      # Mostrar info do console
make keycloak-clean        # Limpar dados
make keycloak-restart      # Reiniciar
```

### Verifica√ß√£o
```bash
# Status dos servi√ßos
make status

# Logs do auth service
make auth-logs

# Testar health check
curl http://localhost:8002/health
```

## üîê Credenciais Padr√£o

### Console Admin Keycloak
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### Usu√°rio da Aplica√ß√£o
- Username: `admin`
- Password: `admin123`
- Role: `ADMIN`

## üåê URLs Importantes

- **Keycloak Admin**: http://localhost:8080/admin
- **Realm vehicle-sales**: http://localhost:8080/realms/vehicle-sales
- **Auth Service**: http://localhost:8002
- **Auth Service Docs**: http://localhost:8002/docs
- **Frontend**: http://localhost:3000

## üìä Valida√ß√£o da Configura√ß√£o

### Checklist
- [ ] Keycloak est√° rodando na porta 8080
- [ ] Realm `vehicle-sales` existe
- [ ] Client `vehicle-sales-app` existe
- [ ] Client secret foi obtido
- [ ] Usu√°rio admin existe com role ADMIN
- [ ] Auth service consegue se comunicar com Keycloak
- [ ] Frontend consegue fazer login

### Script de Valida√ß√£o
```bash
#!/bin/bash
echo "üîç Validando configura√ß√£o do Keycloak..."

# 1. Verificar se Keycloak est√° rodando
if curl -s http://localhost:8080/realms/master > /dev/null; then
    echo "‚úÖ Keycloak est√° rodando"
else
    echo "‚ùå Keycloak n√£o est√° acess√≠vel"
    exit 1
fi

# 2. Verificar se realm existe
if curl -s http://localhost:8080/realms/vehicle-sales > /dev/null; then
    echo "‚úÖ Realm vehicle-sales existe"
else
    echo "‚ùå Realm vehicle-sales n√£o existe"
    exit 1
fi

# 3. Verificar se client secret existe
if [ -f "/tmp/keycloak-credentials-development.env" ]; then
    echo "‚úÖ Client secret foi obtido"
else
    echo "‚ùå Client secret n√£o foi obtido"
    exit 1
fi

# 4. Testar autentica√ß√£o
if curl -s -X POST http://localhost:8002/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "admin", "password": "admin123"}' | grep -q "access_token"; then
    echo "‚úÖ Autentica√ß√£o funcionando"
else
    echo "‚ùå Erro na autentica√ß√£o"
    exit 1
fi

echo "üéâ Configura√ß√£o do Keycloak est√° correta!"
```

## üîÑ Pr√≥ximos Passos

Ap√≥s configurar o Keycloak:

1. **Iniciar todos os servi√ßos**:
   ```bash
   make up
   ```

2. **Acessar o frontend**:
   ```bash
   # Abrir http://localhost:3000
   # Fazer login com admin/admin123
   ```

3. **Testar funcionalidades**:
   - Criar ve√≠culos
   - Gerenciar clientes
   - Processar vendas

4. **Configurar para produ√ß√£o**:
   - Seguir [Guia de Produ√ß√£o](KEYCLOAK_PRODUCTION_GUIDE.md)
   - Configurar HTTPS
   - Usar senhas seguras 

## üöÄ Configura√ß√£o R√°pida (5 minutos)

### 1. Iniciar Keycloak
```bash
# Iniciar o Keycloak
make keycloak

# Aguardar inicializa√ß√£o (pode levar 2-3 minutos)
# Acompanhar logs:
make keycloak-logs
```

### 2. Verificar se est√° funcionando
```bash
# Testar conectividade
curl http://localhost:8080/realms/master

# Deve retornar um JSON com informa√ß√µes do realm
```

### 3. Configurar automaticamente
```bash
# Executar configura√ß√£o autom√°tica
make keycloak-setup

# Aguardar mensagem de sucesso
```

### 4. Obter client secret
```bash
# Obter o client secret
make keycloak-secret

# Verificar se foi criado
cat /tmp/keycloak-credentials-development.env
```

### 5. Testar autentica√ß√£o
```bash
# Testar login
curl -X POST http://localhost:8002/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# Deve retornar access_token e refresh_token
```

## üîß Configura√ß√£o Manual (se autom√°tica falhar)

### 1. Acessar Console Admin
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### 2. Criar Realm
1. Clique em "Create Realm"
2. Nome: `vehicle-sales`
3. Clique em "Create"

### 3. Criar Client
1. V√° para "Clients" ‚Üí "Create client"
2. Client ID: `vehicle-sales-app`
3. Client type: `OpenID Connect`
4. Clique em "Next"
5. Client authentication: `ON`
6. Standard flow: `ON`
7. Direct access grants: `ON`
8. Clique em "Save"

### 4. Configurar Client
1. Na aba "Settings":
   - Valid redirect URIs: `http://localhost:3000/*`
   - Web origins: `http://localhost:3000`
2. Clique em "Save"

### 5. Obter Client Secret
1. V√° para aba "Credentials"
2. Copie o "Client secret"
3. Adicione ao arquivo `.env` do auth-service

### 6. Criar Roles
1. V√° para "Realm roles" ‚Üí "Create role"
2. Criar roles:
   - `ADMIN`
   - `SALES`
   - `CUSTOMER`

### 7. Criar Usu√°rio Admin
1. V√° para "Users" ‚Üí "Create user"
2. Username: `admin`
3. Email: `admin@example.com`
4. Clique em "Create"
5. Na aba "Credentials":
   - Password: `admin123`
   - Temporary: `OFF`
6. Na aba "Role mapping":
   - Assign role: `ADMIN`

## üö® Troubleshooting

### Keycloak n√£o inicia
```bash
# Verificar logs
make keycloak-logs

# Problemas comuns:
# 1. Porta 8080 j√° est√° em uso
sudo lsof -i :8080
# Parar processo que usa a porta ou mudar porta no docker-compose.yml

# 2. Falta de mem√≥ria
docker stats
# Aumentar mem√≥ria dispon√≠vel para Docker

# 3. Dados corrompidos
make keycloak-clean
make keycloak
```

### Client secret n√£o √© obtido
```bash
# Verificar se Keycloak est√° acess√≠vel
curl http://localhost:8080/realms/master

# Verificar se o realm existe
curl http://localhost:8080/realms/vehicle-sales

# Verificar se o client existe
# Acessar http://localhost:8080/admin e verificar manualmente

# Reconfigurar tudo
make keycloak-setup
make keycloak-secret
```

### Erro de autentica√ß√£o
```bash
# Verificar se o client secret est√° correto
cat /tmp/keycloak-credentials-development.env

# Verificar se o auth service est√° usando o secret correto
make auth-logs

# Verificar se o usu√°rio admin existe
# Acessar http://localhost:8080/admin ‚Üí Users
```

### Erro 401 Unauthorized
```bash
# Verificar se o token est√° sendo enviado corretamente
curl -X GET http://localhost:8002/auth/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"

# Verificar se o token n√£o expirou
# Tokens duram 5 minutos por padr√£o
```

## üìù Comandos √öteis

### Keycloak
```bash
make keycloak              # Iniciar Keycloak
make keycloak-logs         # Ver logs
make keycloak-setup        # Configura√ß√£o autom√°tica
make keycloak-secret       # Obter client secret
make keycloak-console      # Mostrar info do console
make keycloak-clean        # Limpar dados
make keycloak-restart      # Reiniciar
```

### Verifica√ß√£o
```bash
# Status dos servi√ßos
make status

# Logs do auth service
make auth-logs

# Testar health check
curl http://localhost:8002/health
```

## üîê Credenciais Padr√£o

### Console Admin Keycloak
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### Usu√°rio da Aplica√ß√£o
- Username: `admin`
- Password: `admin123`
- Role: `ADMIN`

## üåê URLs Importantes

- **Keycloak Admin**: http://localhost:8080/admin
- **Realm vehicle-sales**: http://localhost:8080/realms/vehicle-sales
- **Auth Service**: http://localhost:8002
- **Auth Service Docs**: http://localhost:8002/docs
- **Frontend**: http://localhost:3000

## üìä Valida√ß√£o da Configura√ß√£o

### Checklist
- [ ] Keycloak est√° rodando na porta 8080
- [ ] Realm `vehicle-sales` existe
- [ ] Client `vehicle-sales-app` existe
- [ ] Client secret foi obtido
- [ ] Usu√°rio admin existe com role ADMIN
- [ ] Auth service consegue se comunicar com Keycloak
- [ ] Frontend consegue fazer login

### Script de Valida√ß√£o
```bash
#!/bin/bash
echo "üîç Validando configura√ß√£o do Keycloak..."

# 1. Verificar se Keycloak est√° rodando
if curl -s http://localhost:8080/realms/master > /dev/null; then
    echo "‚úÖ Keycloak est√° rodando"
else
    echo "‚ùå Keycloak n√£o est√° acess√≠vel"
    exit 1
fi

# 2. Verificar se realm existe
if curl -s http://localhost:8080/realms/vehicle-sales > /dev/null; then
    echo "‚úÖ Realm vehicle-sales existe"
else
    echo "‚ùå Realm vehicle-sales n√£o existe"
    exit 1
fi

# 3. Verificar se client secret existe
if [ -f "/tmp/keycloak-credentials-development.env" ]; then
    echo "‚úÖ Client secret foi obtido"
else
    echo "‚ùå Client secret n√£o foi obtido"
    exit 1
fi

# 4. Testar autentica√ß√£o
if curl -s -X POST http://localhost:8002/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "admin", "password": "admin123"}' | grep -q "access_token"; then
    echo "‚úÖ Autentica√ß√£o funcionando"
else
    echo "‚ùå Erro na autentica√ß√£o"
    exit 1
fi

echo "üéâ Configura√ß√£o do Keycloak est√° correta!"
```

## üîÑ Pr√≥ximos Passos

Ap√≥s configurar o Keycloak:

1. **Iniciar todos os servi√ßos**:
   ```bash
   make up
   ```

2. **Acessar o frontend**:
   ```bash
   # Abrir http://localhost:3000
   # Fazer login com admin/admin123
   ```

3. **Testar funcionalidades**:
   - Criar ve√≠culos
   - Gerenciar clientes
   - Processar vendas

4. **Configurar para produ√ß√£o**:
   - Seguir [Guia de Produ√ß√£o](KEYCLOAK_PRODUCTION_GUIDE.md)
   - Configurar HTTPS
   - Usar senhas seguras 

## üöÄ Configura√ß√£o R√°pida (5 minutos)

### 1. Iniciar Keycloak
```bash
# Iniciar o Keycloak
make keycloak

# Aguardar inicializa√ß√£o (pode levar 2-3 minutos)
# Acompanhar logs:
make keycloak-logs
```

### 2. Verificar se est√° funcionando
```bash
# Testar conectividade
curl http://localhost:8080/realms/master

# Deve retornar um JSON com informa√ß√µes do realm
```

### 3. Configurar automaticamente
```bash
# Executar configura√ß√£o autom√°tica
make keycloak-setup

# Aguardar mensagem de sucesso
```

### 4. Obter client secret
```bash
# Obter o client secret
make keycloak-secret

# Verificar se foi criado
cat /tmp/keycloak-credentials-development.env
```

### 5. Testar autentica√ß√£o
```bash
# Testar login
curl -X POST http://localhost:8002/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# Deve retornar access_token e refresh_token
```

## üîß Configura√ß√£o Manual (se autom√°tica falhar)

### 1. Acessar Console Admin
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### 2. Criar Realm
1. Clique em "Create Realm"
2. Nome: `vehicle-sales`
3. Clique em "Create"

### 3. Criar Client
1. V√° para "Clients" ‚Üí "Create client"
2. Client ID: `vehicle-sales-app`
3. Client type: `OpenID Connect`
4. Clique em "Next"
5. Client authentication: `ON`
6. Standard flow: `ON`
7. Direct access grants: `ON`
8. Clique em "Save"

### 4. Configurar Client
1. Na aba "Settings":
   - Valid redirect URIs: `http://localhost:3000/*`
   - Web origins: `http://localhost:3000`
2. Clique em "Save"

### 5. Obter Client Secret
1. V√° para aba "Credentials"
2. Copie o "Client secret"
3. Adicione ao arquivo `.env` do auth-service

### 6. Criar Roles
1. V√° para "Realm roles" ‚Üí "Create role"
2. Criar roles:
   - `ADMIN`
   - `SALES`
   - `CUSTOMER`

### 7. Criar Usu√°rio Admin
1. V√° para "Users" ‚Üí "Create user"
2. Username: `admin`
3. Email: `admin@example.com`
4. Clique em "Create"
5. Na aba "Credentials":
   - Password: `admin123`
   - Temporary: `OFF`
6. Na aba "Role mapping":
   - Assign role: `ADMIN`

## üö® Troubleshooting

### Keycloak n√£o inicia
```bash
# Verificar logs
make keycloak-logs

# Problemas comuns:
# 1. Porta 8080 j√° est√° em uso
sudo lsof -i :8080
# Parar processo que usa a porta ou mudar porta no docker-compose.yml

# 2. Falta de mem√≥ria
docker stats
# Aumentar mem√≥ria dispon√≠vel para Docker

# 3. Dados corrompidos
make keycloak-clean
make keycloak
```

### Client secret n√£o √© obtido
```bash
# Verificar se Keycloak est√° acess√≠vel
curl http://localhost:8080/realms/master

# Verificar se o realm existe
curl http://localhost:8080/realms/vehicle-sales

# Verificar se o client existe
# Acessar http://localhost:8080/admin e verificar manualmente

# Reconfigurar tudo
make keycloak-setup
make keycloak-secret
```

### Erro de autentica√ß√£o
```bash
# Verificar se o client secret est√° correto
cat /tmp/keycloak-credentials-development.env

# Verificar se o auth service est√° usando o secret correto
make auth-logs

# Verificar se o usu√°rio admin existe
# Acessar http://localhost:8080/admin ‚Üí Users
```

### Erro 401 Unauthorized
```bash
# Verificar se o token est√° sendo enviado corretamente
curl -X GET http://localhost:8002/auth/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"

# Verificar se o token n√£o expirou
# Tokens duram 5 minutos por padr√£o
```

## üìù Comandos √öteis

### Keycloak
```bash
make keycloak              # Iniciar Keycloak
make keycloak-logs         # Ver logs
make keycloak-setup        # Configura√ß√£o autom√°tica
make keycloak-secret       # Obter client secret
make keycloak-console      # Mostrar info do console
make keycloak-clean        # Limpar dados
make keycloak-restart      # Reiniciar
```

### Verifica√ß√£o
```bash
# Status dos servi√ßos
make status

# Logs do auth service
make auth-logs

# Testar health check
curl http://localhost:8002/health
```

## üîê Credenciais Padr√£o

### Console Admin Keycloak
- URL: http://localhost:8080/admin
- Usu√°rio: `admin`
- Senha: `admin123`

### Usu√°rio da Aplica√ß√£o
- Username: `admin`
- Password: `admin123`
- Role: `ADMIN`

## üåê URLs Importantes

- **Keycloak Admin**: http://localhost:8080/admin
- **Realm vehicle-sales**: http://localhost:8080/realms/vehicle-sales
- **Auth Service**: http://localhost:8002
- **Auth Service Docs**: http://localhost:8002/docs
- **Frontend**: http://localhost:3000

## üìä Valida√ß√£o da Configura√ß√£o

### Checklist
- [ ] Keycloak est√° rodando na porta 8080
- [ ] Realm `vehicle-sales` existe
- [ ] Client `vehicle-sales-app` existe
- [ ] Client secret foi obtido
- [ ] Usu√°rio admin existe com role ADMIN
- [ ] Auth service consegue se comunicar com Keycloak
- [ ] Frontend consegue fazer login

### Script de Valida√ß√£o
```bash
#!/bin/bash
echo "üîç Validando configura√ß√£o do Keycloak..."

# 1. Verificar se Keycloak est√° rodando
if curl -s http://localhost:8080/realms/master > /dev/null; then
    echo "‚úÖ Keycloak est√° rodando"
else
    echo "‚ùå Keycloak n√£o est√° acess√≠vel"
    exit 1
fi

# 2. Verificar se realm existe
if curl -s http://localhost:8080/realms/vehicle-sales > /dev/null; then
    echo "‚úÖ Realm vehicle-sales existe"
else
    echo "‚ùå Realm vehicle-sales n√£o existe"
    exit 1
fi

# 3. Verificar se client secret existe
if [ -f "/tmp/keycloak-credentials-development.env" ]; then
    echo "‚úÖ Client secret foi obtido"
else
    echo "‚ùå Client secret n√£o foi obtido"
    exit 1
fi

# 4. Testar autentica√ß√£o
if curl -s -X POST http://localhost:8002/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "admin", "password": "admin123"}' | grep -q "access_token"; then
    echo "‚úÖ Autentica√ß√£o funcionando"
else
    echo "‚ùå Erro na autentica√ß√£o"
    exit 1
fi

echo "üéâ Configura√ß√£o do Keycloak est√° correta!"
```

## üîÑ Pr√≥ximos Passos

Ap√≥s configurar o Keycloak:

1. **Iniciar todos os servi√ßos**:
   ```bash
   make up
   ```

2. **Acessar o frontend**:
   ```bash
   # Abrir http://localhost:3000
   # Fazer login com admin/admin123
   ```

3. **Testar funcionalidades**:
   - Criar ve√≠culos
   - Gerenciar clientes
   - Processar vendas

4. **Configurar para produ√ß√£o**:
   - Seguir [Guia de Produ√ß√£o](KEYCLOAK_PRODUCTION_GUIDE.md)
   - Configurar HTTPS
   - Usar senhas seguras 