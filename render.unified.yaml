services:
  # Web Service Único - Backend APIs Unificado
  - type: web
    name: fiap-unified-backend
    env: docker
    plan: starter
    dockerfilePath: ./Dockerfile.unified
    dockerContext: .
    envVars:
      # Configurações do Render
      - key: PORT
        sync: false
      - key: ENVIRONMENT
        value: production
      
      # MongoDB - Banco unificado
      - key: MONGODB_URL
        sync: false
      - key: MONGODB_DB_NAME
        value: fiap_unified_db
      
      # Collections específicas
      - key: AUTH_MONGODB_COLLECTION
        value: users
      - key: CORE_MONGODB_COLLECTION
        value: vehicles
      - key: SALES_MONGODB_COLLECTION
        value: sales
      - key: CUSTOMER_MONGODB_COLLECTION
        value: customers
      
      # Keycloak
      - key: KEYCLOAK_URL
        sync: false
      - key: KEYCLOAK_REALM
        sync: false
      - key: KEYCLOAK_CLIENT_ID
        sync: false
      - key: KEYCLOAK_CLIENT_SECRET
        sync: false
      
      # Redis
      - key: REDIS_URL
        sync: false
      
      # URLs de serviços (internas - localhost)
      - key: AUTH_SERVICE_URL
        value: http://localhost:8000
      - key: CORE_SERVICE_URL
        value: http://localhost:8000
      - key: SALES_SERVICE_URL
        value: http://localhost:8000
      - key: CUSTOMER_SERVICE_URL
        value: http://localhost:8000
      
      # Frontend na Vercel
      - key: FRONTEND_URL
        value: https://fiap-frontend.vercel.app
      - key: ALLOWED_ORIGINS
        value: "https://fiap-frontend.vercel.app,https://localhost:3000"
        
    healthCheckPath: /health
    
    # Sem build command - apenas backend
    buildCommand: echo "✅ Backend unificado pronto para deploy"
      
    # Configurações de deploy
    startCommand: /app/start-unified.sh

# Bancos de dados
databases:
  - name: fiap-unified-mongodb
    databaseName: fiap_unified_db
    plan: starter
    ipAllowList: []

# Redis Key-Value Store  
  - name: fiap-unified-redis
    plan: starter
    maxmemoryPolicy: allkeys-lru 